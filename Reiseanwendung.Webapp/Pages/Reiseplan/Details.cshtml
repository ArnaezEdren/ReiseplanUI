@page "{guid}"
@model Reiseanwendung.Webapp.Pages.Reiseplan.DetailsModel

@if (Model.TravelPlan != null)
{
    <h3>Details @Model.TravelPlan.Name</h3>
    <h4> Infos der Reiseplanung</h4>
    <h4>StartDate: @Model.TravelPlan.StartDate.ToString("yyyy-MM-dd")</h4>
    <h4>EndDate: @Model.TravelPlan.EndDate.ToString("yyyy-MM-dd")</h4>

    <div class="d-flex">
        <!-- Buttons on the left side -->
        <div class="mr-3 mb-3">
            <a asp-page="/Reiseplan/AddDestination" asp-route-travelPlanId="@Model.TravelPlan.Guid" class="btn btn-primary">Add Destination</a>
        </div>

        <!-- Content on the right side -->
        <div class="flex-grow-1">
            <h5>Persons</h5>
            <ul>
                @foreach (var person in Model.TravelPlan.People)
                {
                    <li>@person.Name</li>
                }
            </ul>

            @foreach (var destination in Model.TravelPlan.Destinations)
            {
                <div class="mb-4">
                    <h5>Destination: @destination.City, @destination.Country</h5>
                    <a asp-page="/Reiseplan/EditDestination" asp-route-travelPlanId="@Model.TravelPlan.Guid" asp-route-destinationId="@destination.Guid" class="btn btn-secondary mb-2">Edit Destination</a>
                    <form method="post" asp-page-handler="DeleteDestination" asp-route-travelPlanId="@Model.TravelPlan.Guid" asp-route-destinationId="@destination.Guid" onsubmit="return confirm('Are you sure you want to delete this destination?');">
                        <button type="submit" class="btn btn-danger mb-2">Delete Destination</button>
                    </form>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Activities</th>
                                <th>Accommodations</th>
                                <th>Transportations</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <ul>
                                        @foreach (var activity in destination.Activities)
                                        {
                                            <li>
                                                @activity.Name (@activity.StartDateTime.ToString("yyyy-MM-dd HH:mm") - @activity.EndDateTime.ToString("yyyy-MM-dd HH:mm"))
                                                <form method="post" asp-page-handler="DeleteActivity" asp-route-travelPlanId="@Model.TravelPlan.Guid" asp-route-destinationId="@destination.Guid" asp-route-activityId="@activity.Guid" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this activity?');">
                                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                                </form>
                                            </li>
                                        }
                                    </ul>
                                </td>
                                <td>
                                    <ul>
                                        @foreach (var accommodation in destination.Accommodations)
                                        {
                                            <li>
                                                @accommodation.Name - @($"{accommodation.Address.Street}, {accommodation.Address.City}, {accommodation.Address.Country}, {accommodation.Address.ZipCode}")
                                                <form method="post" asp-page-handler="DeleteAccommodation" asp-route-travelPlanId="@Model.TravelPlan.Guid" asp-route-destinationId="@destination.Guid" asp-route-accommodationId="@accommodation.Guid" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this accommodation?');">
                                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                                </form>
                                            </li>
                                        }
                                    </ul>
                                </td>
                                <td>
                                    <ul>
                                        @foreach (var transportation in destination.Transportations)
                                        {
                                            <li>
                                                @transportation.Type - Booking Number: @transportation.BookingNumber, Round Trip: @(transportation.IsRoundTrip ? "Yes" : "No"), Cost: @(transportation.Cost.ToString("C") ?? "N/A")
                                                <form method="post" asp-page-handler="DeleteTransportation" asp-route-travelPlanId="@Model.TravelPlan.Guid" asp-route-destinationId="@destination.Guid" asp-route-transportationId="@transportation.Guid" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this transportation?');">
                                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                                </form>
                                            </li>
                                        }
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <h4>Total Cost: @Model.TotalCost?.ToString("C")</h4>
}
else
{
    <p>Travel plan details not found.</p>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}